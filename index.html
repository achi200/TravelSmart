<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Smart - –°–∏—Å—Ç–µ–º–∞ –∑–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .screen {
            display: none;
            width: 100%;
            min-height: 100vh;
            background: white;
        }

        .screen.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .content {
            padding: 20px 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            margin: 0 3px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        .navbar {
            background: #2c3e50;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            white-space: nowrap;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background 0.3s ease;
            white-space: nowrap;
        }

        .navbar a:hover {
            background: #34495e;
        }

        .navbar a.active {
            background: #34495e;
            color: #4CAF50;
            font-weight: bold;
        }

        .dashboard-tab {
            display: none;
        }

        .traveler-entry {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            position: relative;
        }

        .traveler-number {
            position: absolute;
            top: -10px;
            left: 15px;
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        .sort-filter-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .sort-filter-bar select,
        .sort-filter-bar input {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
        }

        .insurance-offer-card {
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .insurance-offer-card:hover {
            border-color: #4CAF50;
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
        }

        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .company-logo {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f8f9fa;
        }

        .price-info {
            text-align: right;
        }

        .price-main {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .price-subtitle {
            font-size: 14px;
            color: #666;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #555;
            font-size: 14px;
        }

        .company-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
        }

        .detail-value {
            color: #333;
        }

        .company-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .more-info-link {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }

        .more-info-link:hover {
            text-decoration: underline;
        }

        .search-export-bar {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            align-items: end;
            margin-bottom: 20px;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        .table th,
        .table td {
            padding: 16px 25px;
            text-align: left;
            border-bottom: 1px solid #f1f3f4;
        }

        .table td .btn {
            margin: 2px 4px;
            padding: 8px 16px;
            font-size: 13px;
        }

        .table th {
            background: #fafbfc;
            font-weight: 600;
            color: #555;
            font-size: 14px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }

        .table th:hover {
            background: #f0f0f0;
        }

        .table th.sortable::after {
            content: '‚ÜïÔ∏è';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            opacity: 0.5;
        }

        .table th.sort-asc::after {
            content: '‚Üë';
            opacity: 1;
            color: #4CAF50;
        }

        .table th.sort-desc::after {
            content: '‚Üì';
            opacity: 1;
            color: #4CAF50;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .offer-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e1e5e9;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .country-option {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .country-option:hover {
            background: #f8f9fa;
        }

        .progress-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .progress-track {
            width: 100%;
            background: #e1e5e9;
            height: 6px;
            border-radius: 3px;
        }

        .progress-fill {
            background: #4CAF50;
            height: 6px;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .custom-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .custom-popup.show {
            display: flex;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: popupSlide 0.3s ease-out;
        }

        @keyframes popupSlide {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .popup-content h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .popup-content p {
            margin-bottom: 25px;
            color: #666;
            line-height: 1.5;
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Custom Popup -->
    <div id="customPopup" class="custom-popup">
        <div class="popup-content">
            <h3 id="popupTitle">–ó–∞–≥–ª–∞–≤–∏–µ</h3>
            <p id="popupMessage">–°—ä–æ–±—â–µ–Ω–∏–µ</p>
            <div class="popup-buttons">
                <button class="btn" id="popupConfirm">–î–∞</button>
                <button class="btn btn-secondary" id="popupCancel">–ù–µ</button>
            </div>
        </div>
    </div>

    <!-- –í—Ö–æ–¥ -->
    <div id="loginScreen" class="screen active">
        <div class="login-form">
            <h2 style="text-align: center; margin-bottom: 30px; color: #4CAF50;">Travel Smart</h2>
            <form>
                <div class="form-group">
                    <label for="email">–ò–º–µ–π–ª</label>
                    <input type="email" id="email" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –≤–∞—à–∏—è –∏–º–µ–π–ª">
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª–∞</label>
                    <input type="password" id="password" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –≤–∞—à–∞—Ç–∞ –ø–∞—Ä–æ–ª–∞">
                </div>
                <div class="form-group" style="margin-bottom: 30px;">
                    <input type="checkbox" id="remember"> 
                    <label for="remember" style="display: inline; margin-left: 8px;">–ó–∞–ø–æ–º–Ω–∏ –º–µ</label>
                </div>
                <button type="button" class="btn" style="width: 100%; margin-bottom: 15px;" onclick="showScreen('dashboardScreen')">–í–ª–µ–∑</button>
                <button type="button" class="btn btn-secondary" style="width: 100%; margin-bottom: 15px;" onclick="showScreen('signupScreen')">–°—ä–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª</button>
                <button type="button" class="btn btn-primary" style="width: 100%;" onclick="brokerLogin()">–ë—Ä–æ–∫–µ—Ä –≤—Ö–æ–¥</button>
            </form>
        </div>
    </div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div id="signupScreen" class="screen">
        <div class="login-form">
            <h2 style="text-align: center; margin-bottom: 30px; color: #4CAF50;">–°—ä–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª</h2>
            <form>
                <div class="form-group">
                    <label for="companyName">–ò–º–µ –Ω–∞ –∞–≥–µ–Ω—Ü–∏—è—Ç–∞</label>
                    <input type="text" id="companyName" class="form-control" placeholder="–ò–º–µ –Ω–∞ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—Ç–∞ –∞–≥–µ–Ω—Ü–∏—è">
                </div>
                <div class="form-group">
                    <label for="signupEmail">–ò–º–µ–π–ª</label>
                    <input type="email" id="signupEmail" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –≤–∞—à–∏—è –∏–º–µ–π–ª">
                </div>
                <div class="form-group">
                    <label for="signupPassword">–ü–∞—Ä–æ–ª–∞</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="–°—ä–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª–∞">
                </div>
                <div class="form-group">
                    <label for="authCode">–ö–æ–¥ –∑–∞ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ</label>
                    <input type="text" id="authCode" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω–∏—è –∫–æ–¥">
                </div>
                <div class="form-group">
                    <input type="checkbox" id="enable2fa"> 
                    <label for="enable2fa" style="display: inline; margin-left: 8px;">–í–∫–ª—é—á–∏ –¥–≤—É—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</label>
                </div>
                <button type="button" class="btn" style="width: 100%; margin-bottom: 15px;" onclick="showScreen('dashboardScreen')">–°—ä–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª</button>
                <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showScreen('loginScreen')">–ù–∞–∑–∞–¥ –∫—ä–º –≤—Ö–æ–¥–∞</button>
            </form>
        </div>
    </div>

        <!-- Broker / Master-Admin Screen -->
    <div id="brokerScreen" class="screen">
      <div class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: #4CAF50;">
          –í—Ö–æ–¥ –ë—Ä–æ–∫–µ—Ä / –ê–¥–º–∏–Ω
        </h2>
        <div>
          <h4 style="margin-bottom: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∞–≥–µ–Ω—Ü–∏–∏</h4>
          <ul id="agenciesList" style="list-style: none; padding: 0; margin-bottom: 20px;">
            <!-- JS will inject each agency here -->
          </ul>
          <div style="display: flex; gap: 10px; margin-bottom: 30px;">
            <input
              type="text"
              id="newAgencyName"
              class="form-control"
              placeholder="–ò–º–µ –Ω–∞ –Ω–æ–≤–∞ –∞–≥–µ–Ω—Ü–∏—è"
              style="flex:1;"
            >
            <button class="btn" onclick="addAgency()">–î–æ–±–∞–≤–∏</button>
          </div>
          <button
            type="button"
            class="btn"
            style="width: 100%; margin-bottom: 15px;"
            onclick="showScreen('loginScreen')"
          >
            –ò–∑—Ö–æ–¥
          </button>
        </div>
      </div>
    </div>


    <!-- –¢–∞–±–ª–æ –Ω–∞ –∞–≥–µ–Ω—Ü–∏—è—Ç–∞ -->
    <div id="dashboardScreen" class="screen">
        <div class="header">
            <div class="logo">Travel Smart</div>
            <div class="user-info">
                <span>–î–æ–±—Ä–µ –¥–æ—à–ª–∏, –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è XYZ</span>
                <button class="btn btn-secondary" onclick="showScreen('loginScreen')">–ò–∑—Ö–æ–¥</button>
            </div>
        </div>
        
        <div class="navbar">
            <div class="navbar-left">
                <a href="#" onclick="showDashboardTab('offers')" id="offersNavLink" class="active">–û—Ñ–µ—Ä—Ç–∏</a>
                <a href="#" onclick="showDashboardTab('policies')" id="policiesNavLink">–ü–æ–ª–∏—Ü–∏</a>
                <a href="#" onclick="showDashboardTab('export')" id="exportNavLink">–ï–∫—Å–ø–æ—Ä—Ç</a>
                <a href="#" onclick="showDashboardTab('users')" id="usersNavLink" style="display: none;">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a>
                <a href="#" onclick="showDashboardTab('settings')" id="settingsNavLink">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
            <div>
                <button class="btn" onclick="showScreen('newOfferScreen')">+ –ù–æ–≤–∞ –æ—Ñ–µ—Ä—Ç–∞</button>
            </div>
        </div>

        <div class="content">
            <!-- –†–∞–∑–¥–µ–ª –û—Ñ–µ—Ä—Ç–∏ -->
            <div id="offersTab" class="dashboard-tab" style="display: block;">
                <div class="search-export-bar">
                    <div>
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∏</h3>
                        <input type="text" class="form-control" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –Ω–æ–º–µ—Ä, –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏—è" id="searchOffers" onkeyup="searchOffers()" style="width: 100%;">
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="clearOfferSearch()" style="width: 100%;">–ò–∑—á–∏—Å—Ç–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ</button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>–°—ä–∑–¥–∞–¥–µ–Ω–∏ –æ—Ñ–µ—Ä—Ç–∏</h3>
                        <button class="btn" onclick="showScreen('newOfferScreen')">+ –ù–æ–≤–∞ –æ—Ñ–µ—Ä—Ç–∞</button>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</th>
                                <th class="sortable" onclick="sortOffersBy('client')" id="clientHeader">–ö–ª–∏–µ–Ω—Ç</th>
                                <th class="sortable" onclick="sortOffersBy('destination')" id="destinationHeader">–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è</th>
                                <th class="sortable" onclick="sortOffersBy('dates')" id="datesHeader">–î–∞—Ç–∏ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</th>
                                <th class="sortable" onclick="sortOffersBy('premium')" id="premiumHeader">–ü—Ä–µ–º–∏—è</th>
                                <th class="sortable" onclick="sortOffersBy('company')" id="companyHeader">–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="offersTableBody">
                            <tr>
                                <td>OF-2025-001</td>
                                <td>–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</td>
                                <td>–ú–∞–¥—Ä–∏–¥, –ò—Å–ø–∞–Ω–∏—è</td>
                                <td>15.07.2025 - 25.07.2025</td>
                                <td>125 –ª–≤.</td>
                                <td><span class="badge badge-info">Euroins</span></td>
                                <td><span class="badge badge-warning">–û—Ñ–µ—Ä—Ç–∞</span></td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editOffer('OF-2025-001')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-primary" onclick="createPolicyFromOffer('OF-2025-001')">–ò–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∞</button>
                                    <button class="btn" onclick="viewOffer('OF-2025-001')">–ü—Ä–µ–≥–ª–µ–¥</button>
                                </td>
                            </tr>
                            <tr>
                                <td>OF-2025-002</td>
                                <td>–ú–∞—Ä–∏—è –ì–µ–æ—Ä–≥–∏–µ–≤–∞</td>
                                <td>–†–∏–º, –ò—Ç–∞–ª–∏—è</td>
                                <td>01.08.2025 - 14.08.2025</td>
                                <td>185 –ª–≤.</td>
                                <td><span class="badge badge-info">Allianz</span></td>
                                <td><span class="badge badge-warning">–û—Ñ–µ—Ä—Ç–∞</span></td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editOffer('OF-2025-002')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-primary" onclick="createPolicyFromOffer('OF-2025-002')">–ò–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∞</button>
                                    <button class="btn" onclick="viewOffer('OF-2025-002')">–ü—Ä–µ–≥–ª–µ–¥</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª –ü–æ–ª–∏—Ü–∏ -->
            <div id="policiesTab" class="dashboard-tab">
                <div class="search-export-bar">
                    <div>
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∏</h3>
                        <input type="text" class="form-control" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –Ω–æ–º–µ—Ä, –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏—è" id="searchPolicies" onkeyup="searchPolicies()" style="width: 100%;">
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="clearPolicySearch()" style="width: 100%;">–ò–∑—á–∏—Å—Ç–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ</button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>–ê–∫—Ç–∏–≤–Ω–∏ –ø–æ–ª–∏—Ü–∏</h3>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä –Ω–∞ –ø–æ–ª–∏—Ü–∞</th>
                                <th class="sortable" onclick="sortPoliciesBy('client')" id="policyClientHeader">–ö–ª–∏–µ–Ω—Ç</th>
                                <th class="sortable" onclick="sortPoliciesBy('destination')" id="policyDestinationHeader">–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è</th>
                                <th class="sortable" onclick="sortPoliciesBy('dates')" id="policyDatesHeader">–î–∞—Ç–∏ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</th>
                                <th class="sortable" onclick="sortPoliciesBy('premium')" id="policyPremiumHeader">–ü—Ä–µ–º–∏—è</th>
                                <th class="sortable" onclick="sortPoliciesBy('company')" id="policyCompanyHeader">–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="policiesTableBody">
                            <tr>
                                <td>TG-2025-001</td>
                                <td>–ì–µ–æ—Ä–≥–∏ –î–∏–º–∏—Ç—Ä–æ–≤</td>
                                <td>–ü–∞—Ä–∏–∂, –§—Ä–∞–Ω—Ü–∏—è</td>
                                <td>10.09.2025 - 20.09.2025</td>
                                <td>155 –ª–≤.</td>
                                <td><span class="badge badge-info">Uniqa</span></td>
                                <td><span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–∞</span></td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editPolicy('TG-2025-001')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-primary" onclick="viewPolicy('TG-2025-001')">–ü—Ä–µ–≥–ª–µ–¥</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª –ï–∫—Å–ø–æ—Ä—Ç -->
            <div id="exportTab" class="dashboard-tab">
                <div class="table-container">
                    <div class="table-header">
                        <h3>–ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ –¥–∞–Ω–Ω–∏</h3>
                    </div>
                    <div style="padding: 40px;">
                        <div style="max-width: 600px; margin: 0 auto;">
                            <div class="form-group">
                                <label>–¢–∏–ø –¥–∞–Ω–Ω–∏ –∑–∞ –µ–∫—Å–ø–æ—Ä—Ç</label>
                                <select id="exportType" class="form-control">
                                    <option value="policies">–ü–æ–ª–∏—Ü–∏</option>
                                    <option value="offers">–û—Ñ–µ—Ä—Ç–∏</option>
                                    <option value="all">–í—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–û—Ç –¥–∞—Ç–∞</label>
                                    <input type="date" id="exportFromDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>–î–æ –¥–∞—Ç–∞</label>
                                    <input type="date" id="exportToDate" class="form-control">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>–§–æ—Ä–º–∞—Ç –Ω–∞ —Ñ–∞–π–ª–∞</label>
                                <select id="exportFormat" class="form-control">
                                    <option value="excel">Excel (.xlsx)</option>
                                    <option value="csv">CSV</option>
                                    <option value="pdf">PDF</option>
                                </select>
                            </div>

                            <div style="text-align: center; margin-top: 30px;">
                                <button class="btn" onclick="performExport()" style="font-size: 16px; padding: 15px 40px;">
                                    –ò–∑—Ç–µ–≥–ª–∏ —Ñ–∞–π–ª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ -->
            <div id="usersTab" class="dashboard-tab">
                <div class="table-container">
                    <div class="table-header">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h3>
                        <button class="btn" onclick="showModal('addUserModal')">+ –î–æ–±–∞–≤–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</button>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ò–º–µ</th>
                                <th>–ò–º–µ–π–ª</th>
                                <th>–†–æ–ª—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ü–æ—Å–ª–µ–¥–µ–Ω –≤—Ö–æ–¥</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td>–ü–µ—Ç—ä—Ä –ò–≤–∞–Ω–æ–≤</td>
                                <td>petar@travelxyz.com</td>
                                <td><span class="badge" style="background: #f8d7da; color: #721c24;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span></td>
                                <td><span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span></td>
                                <td>24.06.2025 14:30</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editUser('user1')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-danger" onclick="removeUser('user1')">–ü—Ä–µ–º–∞—Ö–Ω–∏</button>
                                </td>
                            </tr>
                            <tr>
                                <td>–ú–∞—Ä–∏—è –°—Ç–æ—è–Ω–æ–≤–∞</td>
                                <td>maria@travelxyz.com</td>
                                <td><span class="badge badge-info">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span></td>
                                <td><span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span></td>
                                <td>23.06.2025 16:45</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editUser('user2')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-danger" onclick="removeUser('user2')">–ü—Ä–µ–º–∞—Ö–Ω–∏</button>
                                </td>
                            </tr>
                            <tr>
                                <td>–ì–µ–æ—Ä–≥–∏ –ü–µ—Ç–∫–æ–≤</td>
                                <td>georgi@travelxyz.com</td>
                                <td><span class="badge badge-info">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span></td>
                                <td><span class="badge badge-warning">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span></td>
                                <td>20.06.2025 09:15</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editUser('user3')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                                    <button class="btn btn-danger" onclick="removeUser('user3')">–ü—Ä–µ–º–∞—Ö–Ω–∏</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div id="settingsTab" class="dashboard-tab">
                <div class="table-container">
                    <div class="table-header">
                        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∫–æ–º–ø–∞–Ω–∏—è—Ç–∞</h3>
                    </div>
                    <div style="padding: 25px;">
                        <div class="form-group">
                            <label>–ò–º–µ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è—Ç–∞</label>
                            <input type="text" class="form-control" value="–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è XYZ">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω—Ç–∞–∫—Ç–µ–Ω –∏–º–µ–π–ª</label>
                            <input type="email" class="form-control" value="contact@travelxyz.com">
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" class="form-control" value="+359 2 123 4567">
                        </div>
                        <div class="form-group">
                            <label>–ê–¥—Ä–µ—Å</label>
                            <input type="text" class="form-control" value="—É–ª. –í–∏—Ç–æ—à–∞ 15, –°–æ—Ñ–∏—è 1000">
                        </div>
                        <button class="btn">–ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–æ–≤–∞ –æ—Ñ–µ—Ä—Ç–∞ - –°—Ç—ä–ø–∫–∞ 1 -->
    <div id="newOfferScreen" class="screen">
        <div class="header">
            <div class="logo">Travel Smart - –ù–æ–≤–∞ –æ—Ñ–µ—Ä—Ç–∞</div>
            <div class="user-info">
                <button class="btn btn-secondary" onclick="showScreen('dashboardScreen')">–ù–∞–∑–∞–¥ –∫—ä–º —Ç–∞–±–ª–æ—Ç–æ</button>
            </div>
        </div>

        <div class="content">
            <div class="progress-bar">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-weight: bold; color: #4CAF50;">–°—Ç—ä–ø–∫–∞ 1 –æ—Ç 2</span>
                    <span style="color: #666;">–î–µ—Ç–∞–π–ª–∏ –∑–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" style="width: 50%;"></div>
                </div>
            </div>

            <div class="offer-form">
                <h2 style="margin-bottom: 30px; color: #4CAF50;">–î–µ—Ç–∞–π–ª–∏ –∑–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ</h2>
                
                <div class="form-group">
                    <label for="travelDestination">–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è</label>
                    <div style="position: relative;">
                        <input type="text" id="travelDestination" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–ª–∏ –∏–∑–±–µ—Ä–µ—Ç–µ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏—è" onkeyup="filterCountries()" onclick="showCountryDropdown()">
                        <div id="countryDropdown" class="country-dropdown">
                            <!-- Countries will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="travelPurpose">–¶–µ–ª –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ</label>
                    <select id="travelPurpose" class="form-control">
                        <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ —Ü–µ–ª</option>
                        <option value="business">–ë–∏–∑–Ω–µ—Å</option>
                        <option value="leisure">–¢—É—Ä–∏–∑—ä–º/–ü–æ—á–∏–≤–∫–∞</option>
                        <option value="study">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ/–£—á–µ–±–∞</option>
                        <option value="medical">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ –ª–µ—á–µ–Ω–∏–µ</option>
                        <option value="family">–ü–æ—Å–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–µ–º–µ–π—Å—Ç–≤–æ</option>
                        <option value="sports">–°–ø–æ—Ä—Ç–Ω–∏ –¥–µ–π–Ω–æ—Å—Ç–∏</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="insuranceAmount">–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ —Å—É–º–∞</label>
                    <select id="insuranceAmount" class="form-control">
                        <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ —Å—É–º–∞</option>
                        <option value="30000">30,000 –µ–≤—Ä–æ</option>
                        <option value="50000">50,000 –µ–≤—Ä–æ</option>
                        <option value="100000">100,000 –µ–≤—Ä–æ</option>
                        <option value="200000">200,000 –µ–≤—Ä–æ</option>
                        <option value="500000">500,000 –µ–≤—Ä–æ</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="departureDate">–î–∞—Ç–∞ –Ω–∞ –∑–∞–º–∏–Ω–∞–≤–∞–Ω–µ</label>
                        <input type="date" id="departureDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="returnDate">–î–∞—Ç–∞ –Ω–∞ –∑–∞–≤—Ä—ä—â–∞–Ω–µ</label>
                        <input type="date" id="returnDate" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ü—ä—Ç—É–≤–∞—â–∏</label>
                    <div id="travelersContainer">
                        <div class="traveler-entry">
                            <div class="traveler-number">1</div>
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #666;">–í—ä–∑—Ä–∞—Å—Ç</label>
                                <input type="number" class="form-control" placeholder="–í—ä–∑—Ä–∞—Å—Ç" min="0" max="120" onchange="updateTravelersCount()">
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 15px;">
                        <button type="button" class="btn btn-secondary" onclick="addTraveler()">+ –î–æ–±–∞–≤–∏ –ø—ä—Ç—É–≤–∞—â</button>
                        <button type="button" class="btn btn-danger" onclick="removeLastTraveler()" id="removeLastBtn" style="display: none;">- –ü—Ä–µ–º–∞—Ö–Ω–∏ –ø–æ—Å–ª–µ–¥–µ–Ω</button>
                        <small style="color: #666; margin-left: 10px;">–û–±—â–æ –ø—ä—Ç—É–≤–∞—â–∏: <span id="travelersCount">1</span></small>
                    </div>
                </div>

                <div style="margin-top: 40px; text-align: center;">
                    <button type="button" class="btn" style="font-size: 18px; padding: 15px 40px;" onclick="proceedToOffers()">–ü—Ä–æ–¥—ä–ª–∂–∏ –∫—ä–º –æ—Ñ–µ—Ä—Ç–∏</button>
                    <button type="button" class="btn btn-secondary" style="margin-left: 20px;" onclick="showScreen('dashboardScreen')">–û—Ç–∫–∞–∑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–∑–±–æ—Ä –Ω–∞ –æ—Ñ–µ—Ä—Ç–∏ - –°—Ç—ä–ø–∫–∞ 2 -->
    <div id="selectOffersScreen" class="screen">
        <div class="header">
            <div class="logo">Travel Smart - –ò–∑–±–æ—Ä –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</div>
            <div class="user-info">
                <button class="btn btn-secondary" onclick="showScreen('newOfferScreen')">–ù–∞–∑–∞–¥</button>
                <button class="btn btn-secondary" onclick="showScreen('dashboardScreen')">–ö—ä–º —Ç–∞–±–ª–æ—Ç–æ</button>
            </div>
        </div>

        <div class="content">
            <div class="progress-bar">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-weight: bold; color: #4CAF50;">–°—Ç—ä–ø–∫–∞ 2 –æ—Ç 2</span>
                    <span style="color: #666;">–ò–∑–±–æ—Ä –Ω–∞ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>

            <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">–†–µ–∑—é–º–µ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <strong>–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è:</strong>
                        <div id="summaryDestination">-</div>
                    </div>
                    <div>
                        <strong>–¶–µ–ª:</strong>
                        <div id="summaryPurpose">-</div>
                    </div>
                    <div>
                        <strong>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ —Å—É–º–∞:</strong>
                        <div id="summaryAmount">-</div>
                    </div>
                    <div>
                        <strong>–î–∞—Ç–∏ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ:</strong>
                        <div id="summaryDates">-</div>
                    </div>
                    <div>
                        <strong>–ë—Ä–æ–π –ø—ä—Ç—É–≤–∞—â–∏:</strong>
                        <div id="summaryTravelers">-</div>
                    </div>
                </div>
            </div>

            <div style="background: white; border-radius: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); overflow: hidden;">
                <div style="background: #f8f9fa; padding: 20px; border-bottom: 1px solid #e1e5e9;">
                    <h3 style="margin: 0; color: #2c3e50;">–ù–∞–ª–∏—á–Ω–∏ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∏ –æ—Ñ–µ—Ä—Ç–∏</h3>
                </div>
                
                <div id="insuranceOffersContainer" style="padding: 20px;">
                    <!-- Offers will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('addUserModal')">&times;</span>
            <h3>–î–æ–±–∞–≤–∏ –Ω–æ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</h3>
            <div class="form-group">
                <label>–ü—ä–ª–Ω–æ –∏–º–µ</label>
                <input type="text" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—ä–ª–Ω–æ—Ç–æ –∏–º–µ" id="newUserName">
            </div>
            <div class="form-group">
                <label>–ò–º–µ–π–ª</label>
                <input type="email" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ–π–ª" id="newUserEmail">
            </div>
            <div class="form-group">
                <label>–†–æ–ª—è</label>
                <select class="form-control" id="newUserRole">
                    <option value="user">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</option>
                    <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                </select>
            </div>
            <button type="button" class="btn" onclick="addNewUser()">–ò–∑–ø—Ä–∞—Ç–∏ –ø–æ–∫–∞–Ω–∞</button>
            <button type="button" class="btn btn-secondary" onclick="hideModal('addUserModal')">–û—Ç–∫–∞–∑</button>
        </div>
    </div>

    <div id="createPolicyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('createPolicyModal')">&times;</span>
            <h3>–ò–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∞ –æ—Ç –æ—Ñ–µ—Ä—Ç–∞</h3>
            <p>–û—Ñ–µ—Ä—Ç–∞ –Ω–æ–º–µ—Ä: <strong id="offerNumber"></strong></p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #2c3e50;">–î–µ—Ç–∞–π–ª–∏ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞—Ç–∞</h4>
                <div id="offerDetails" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <!-- Offer details will be populated here -->
                </div>
            </div>

            <div class="form-group">
                <label for="clientName">–ò–º–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞</label>
                <input type="text" id="clientName" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—ä–ª–Ω–æ—Ç–æ –∏–º–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="clientPhone" class="form-control" placeholder="+359...">
                </div>
                <div class="form-group">
                    <label for="clientEmail">–ò–º–µ–π–ª</label>
                    <input type="email" id="clientEmail" class="form-control" placeholder="email@example.com">
                </div>
            </div>

            <div class="form-group">
                <label for="clientAddress">–ê–¥—Ä–µ—Å</label>
                <input type="text" id="clientAddress" class="form-control" placeholder="–ü—ä–ª–µ–Ω –∞–¥—Ä–µ—Å">
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn" onclick="finalizePolicy()">–ò–∑–¥–∞–π –ø–æ–ª–∏—Ü–∞</button>
                <button class="btn btn-secondary" onclick="hideModal('createPolicyModal')">–û—Ç–∫–∞–∑</button>
            </div>
        </div>
    </div>

    <!-- Offer Preview Modal -->
    <div id="offerPreviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('offerPreviewModal')">&times;</span>
            <h3>–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞</h3>
            <div id="offerPreviewContent">
                <!-- Offer preview content will be populated here -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="hideModal('offerPreviewModal')">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <!-- Policy Preview Modal -->
    <div id="policyPreviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('policyPreviewModal')">&times;</span>
            <h3>–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ø–æ–ª–∏—Ü–∞</h3>
            <div id="policyPreviewContent">
                <!-- Policy preview content will be populated here -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="hideModal('policyPreviewModal')">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        var currentUserRole = 'admin';
        var currentOfferData = {};
        
        var countries = [
            '–ê–≤—Å—Ç—Ä–∏—è', '–ê–≤—Å—Ç—Ä–∞–ª–∏—è', '–ë–µ–ª–≥–∏—è', '–ë—ä–ª–≥–∞—Ä–∏—è', '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', '–ì–µ—Ä–º–∞–Ω–∏—è', '–ì—ä—Ä—Ü–∏—è', 
            '–î–∞–Ω–∏—è', '–ï–≥–∏–ø–µ—Ç', '–ò—Å–ø–∞–Ω–∏—è', '–ò—Ç–∞–ª–∏—è', '–ö–∏–ø—ä—Ä', '–ú–∞–ª—Ç–∞', '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è', '–ù–æ—Ä–≤–µ–≥–∏—è',
            '–ü–æ–ª—à–∞', '–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è', '–†—É–º—ä–Ω–∏—è', '–°–ê–©', '–¢–∞–π–ª–∞–Ω–¥', '–¢—É—Ä—Ü–∏—è', '–§—Ä–∞–Ω—Ü–∏—è', '–•—ä—Ä–≤–∞—Ç–∏—è',
            '–ß–µ—Ö–∏—è', '–®–≤–µ–π—Ü–∞—Ä–∏—è', '–®–≤–µ—Ü–∏—è'
        ];

        var insuranceCompanies = [
            { name: 'Euroins', logo: 'üõ°Ô∏è', color: '#e74c3c' },
            { name: 'Allianz', logo: 'üî∑', color: '#3498db' },
            { name: 'Uniqa', logo: 'üü¶', color: '#9b59b6' },
            { name: 'Lev Ins', logo: 'ü¶Å', color: '#f39c12' },
            { name: 'Bulstrad', logo: '‚≠ê', color: '#27ae60' }
        ];

        var offers = [
            {
                id: 'OF-2025-001',
                client: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                destination: '–ú–∞–¥—Ä–∏–¥, –ò—Å–ø–∞–Ω–∏—è',
                dates: '15.07.2025 - 25.07.2025',
                premium: '125 –ª–≤.',
                company: 'Euroins',
                travelersCount: 2,
                status: 'offer'
            },
            {
                id: 'OF-2025-002',
                client: '–ú–∞—Ä–∏—è –ì–µ–æ—Ä–≥–∏–µ–≤–∞',
                destination: '–†–∏–º, –ò—Ç–∞–ª–∏—è',
                dates: '01.08.2025 - 14.08.2025',
                premium: '185 –ª–≤.',
                company: 'Allianz',
                travelersCount: 1,
                status: 'offer'
            }
        ];

        var policies = [
            {
                id: 'TG-2025-001',
                client: '–ì–µ–æ—Ä–≥–∏ –î–∏–º–∏—Ç—Ä–æ–≤',
                destination: '–ü–∞—Ä–∏–∂, –§—Ä–∞–Ω—Ü–∏—è',
                dates: '10.09.2025 - 20.09.2025',
                premium: '155 –ª–≤.',
                company: 'Uniqa',
                status: 'active'
            }
        ];

        // Core functions
        function showScreen(screenId) {
            var screens = document.querySelectorAll('.screen');
            for (var i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById(screenId).classList.add('active');
        }

        function showDashboardTab(tabId) {
            var tabs = document.querySelectorAll('.dashboard-tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].style.display = 'none';
            }
            
            var links = document.querySelectorAll('.navbar a');
            for (var i = 0; i < links.length; i++) {
                links[i].classList.remove('active');
            }
            
            document.getElementById(tabId + 'NavLink').classList.add('active');
            document.getElementById(tabId + 'Tab').style.display = 'block';
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Custom popup functions
        function showCustomPopup(title, message, onConfirm, onCancel) {
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupMessage').textContent = message;
            
            var popup = document.getElementById('customPopup');
            var confirmBtn = document.getElementById('popupConfirm');
            var cancelBtn = document.getElementById('popupCancel');
            
            confirmBtn.onclick = null;
            cancelBtn.onclick = null;
            
            confirmBtn.onclick = function() {
                hideCustomPopup();
                if (onConfirm) onConfirm();
            };
            
            if (onCancel) {
                cancelBtn.style.display = 'inline-block';
                cancelBtn.onclick = function() {
                    hideCustomPopup();
                    onCancel();
                };
            } else {
                cancelBtn.style.display = 'none';
            }
            
            popup.classList.add('show');
        }

        function hideCustomPopup() {
            document.getElementById('customPopup').classList.remove('show');
        }

        function showAlert(title, message) {
            showCustomPopup(title, message, null, null);
        }

        function showConfirm(title, message, onConfirm, onCancel) {
            showCustomPopup(title, message, onConfirm, onCancel);
        }

        // Country dropdown functions
        function showCountryDropdown() {
            var dropdown = document.getElementById('countryDropdown');
            dropdown.style.display = 'block';
            populateCountries();
        }

        function populateCountries(filter) {
            filter = filter || '';
            var dropdown = document.getElementById('countryDropdown');
            var filteredCountries = [];
            
            for (var i = 0; i < countries.length; i++) {
                if (countries[i].toLowerCase().indexOf(filter.toLowerCase()) !== -1) {
                    filteredCountries.push(countries[i]);
                }
            }

            var html = '';
            for (var i = 0; i < filteredCountries.length; i++) {
                html += '<div class="country-option" onclick="selectCountry(\'' + filteredCountries[i] + '\')">' + filteredCountries[i] + '</div>';
            }
            dropdown.innerHTML = html;
        }

        function filterCountries() {
            var input = document.getElementById('travelDestination');
            populateCountries(input.value);
        }

        function selectCountry(country) {
            document.getElementById('travelDestination').value = country;
            document.getElementById('countryDropdown').style.display = 'none';
        }

        // Traveler functions
        function addTraveler() {
            var container = document.getElementById('travelersContainer');
            var count = container.children.length + 1;
            var travelerDiv = document.createElement('div');
            travelerDiv.className = 'traveler-entry';
            travelerDiv.innerHTML = '<div class="traveler-number">' + count + '</div><div style="flex: 1;"><label style="display: block; margin-bottom: 5px; font-size: 14px; color: #666;">–í—ä–∑—Ä–∞—Å—Ç</label><input type="number" class="form-control" placeholder="–í—ä–∑—Ä–∞—Å—Ç" min="0" max="120" onchange="updateTravelersCount()"></div>';
            container.appendChild(travelerDiv);
            updateTravelersCount();
            updateTravelerButtons();
        }

        function removeLastTraveler() {
            var container = document.getElementById('travelersContainer');
            if (container.children.length > 1) {
                container.removeChild(container.lastElementChild);
                updateTravelersCount();
                updateTravelerButtons();
            }
        }

        function updateTravelerButtons() {
            var container = document.getElementById('travelersContainer');
            var removeBtn = document.getElementById('removeLastBtn');
            
            if (container.children.length > 1) {
                removeBtn.style.display = 'inline-block';
            } else {
                removeBtn.style.display = 'none';
            }
        }

        function updateTravelersCount() {
            var container = document.getElementById('travelersContainer');
            var count = container.children.length;
            document.getElementById('travelersCount').textContent = count;
        }

        // Offer creation functions
        function proceedToOffers() {
            var destination = document.getElementById('travelDestination').value;
            var purpose = document.getElementById('travelPurpose').value;
            var amount = document.getElementById('insuranceAmount').value;
            var departureDate = document.getElementById('departureDate').value;
            var returnDate = document.getElementById('returnDate').value;
            var ageInputs = document.querySelectorAll('#travelersContainer input[type="number"]');
            
            if (!destination || !purpose || !amount || !departureDate || !returnDate) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!');
                return;
            }

            if (new Date(returnDate) <= new Date(departureDate)) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–î–∞—Ç–∞—Ç–∞ –Ω–∞ –∑–∞–≤—Ä—ä—â–∞–Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ —Å–ª–µ–¥ –¥–∞—Ç–∞—Ç–∞ –Ω–∞ –∑–∞–º–∏–Ω–∞–≤–∞–Ω–µ!');
                return;
            }

            var ages = [];
            for (var i = 0; i < ageInputs.length; i++) {
                if (ageInputs[i].value) {
                    ages.push(ageInputs[i].value);
                }
            }
            
            if (ages.length !== ageInputs.length) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –≤—ä–∑—Ä–∞—Å—Ç—Ç–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø—ä—Ç—É–≤–∞—â–∏!');
                return;
            }

            currentOfferData = {
                destination: destination,
                purpose: purpose,
                amount: amount,
                departureDate: departureDate,
                returnDate: returnDate,
                ages: ages,
                travelersCount: ages.length
            };

            updateOfferSummary();
            generateInsuranceOffers();
            showScreen('selectOffersScreen');
        }

        function updateOfferSummary() {
            var purposeMap = {
                'business': '–ë–∏–∑–Ω–µ—Å',
                'leisure': '–¢—É—Ä–∏–∑—ä–º/–ü–æ—á–∏–≤–∫–∞',
                'study': '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ/–£—á–µ–±–∞',
                'medical': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ –ª–µ—á–µ–Ω–∏–µ',
                'family': '–ü–æ—Å–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–µ–º–µ–π—Å—Ç–≤–æ',
                'sports': '–°–ø–æ—Ä—Ç–Ω–∏ –¥–µ–π–Ω–æ—Å—Ç–∏'
            };

            document.getElementById('summaryDestination').textContent = currentOfferData.destination;
            document.getElementById('summaryPurpose').textContent = purposeMap[currentOfferData.purpose];
            document.getElementById('summaryAmount').textContent = new Intl.NumberFormat('bg-BG').format(currentOfferData.amount) + ' –µ–≤—Ä–æ';
            document.getElementById('summaryDates').textContent = currentOfferData.departureDate + ' - ' + currentOfferData.returnDate;
            document.getElementById('summaryTravelers').textContent = currentOfferData.travelersCount + ' (' + currentOfferData.ages.join(', ') + ' –≥.)';
        }

        function generateInsuranceOffers() {
            var container = document.getElementById('insuranceOffersContainer');
            var basePrice = calculateBasePrice();
            
            var html = '';
            for (var i = 0; i < insuranceCompanies.length; i++) {
                var company = insuranceCompanies[i];
                var price = Math.round(basePrice * (0.8 + Math.random() * 0.4));
                var features = getCompanyFeatures(company.name);
                var details = getCompanyDetails(company.name);
                
                html += '<div class="insurance-offer-card" onclick="selectInsuranceOffer(\'' + company.name + '\', ' + price + ')">';
                html += '<div class="company-header">';
                html += '<div class="company-info">';
                html += '<div class="company-logo" style="background: ' + company.color + '20;">';
                html += '<span style="font-size: 32px;">' + company.logo + '</span>';
                html += '</div>';
                html += '<div>';
                html += '<h4 style="margin: 0; color: ' + company.color + '; font-size: 20px;">' + company.name + '</h4>';
                html += '<p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">' + details.description + '</p>';
                html += '</div>';
                html += '</div>';
                html += '<div class="price-info">';
                html += '<div class="price-main" style="color: ' + company.color + ';">' + price + ' –ª–≤.</div>';
                html += '<div class="price-subtitle">–∑–∞ —Ü—è–ª–æ—Ç–æ –ø—ä—Ç—É–≤–∞–Ω–µ</div>';
                html += '</div>';
                html += '</div>';
                
                html += '<div class="company-details">';
                html += '<h5 style="margin-bottom: 15px; color: #2c3e50;">–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ–∫—Ä–∏—Ç–∏–µ—Ç–æ</h5>';
                html += '<div class="details-grid">';
                html += '<div class="detail-item"><span class="detail-label">–†–µ–π—Ç–∏–Ω–≥:</span><span class="detail-value">' + details.rating + '/10</span></div>';
                html += '<div class="detail-item"><span class="detail-label">–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —â–µ—Ç–∏:</span><span class="detail-value">' + details.claimProcessing + '</span></div>';
                html += '<div class="detail-item"><span class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span><span class="detail-value">' + details.phone + '</span></div>';
                html += '<div class="detail-item"><span class="detail-label">–ü–æ–∫—Ä–∏—Ç–∏–µ COVID-19:</span><span class="detail-value">' + details.covidCoverage + '</span></div>';
                html += '</div>';
                html += '</div>';

                html += '<div class="features-grid">';
                for (var j = 0; j < features.length; j++) {
                    html += '<div class="feature-item">';
                    html += '<span style="color: #4CAF50; font-weight: bold;">‚úì</span>';
                    html += '<span>' + features[j] + '</span>';
                    html += '</div>';
                }
                html += '</div>';

                html += '<div class="company-actions">';
                html += '<button class="btn" style="background: ' + company.color + '; padding: 12px 30px;">–ò–∑–±–µ—Ä–∏ —Ç–∞–∑–∏ –æ—Ñ–µ—Ä—Ç–∞</button>';
                html += '<a href="#" class="more-info-link" onclick="event.stopPropagation(); showCompanyInfo(\'' + company.name + '\')">–ü–æ–≤–µ—á–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üí</a>';
                html += '</div>';
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function calculateBasePrice() {
            var amount = parseInt(currentOfferData.amount);
            var travelersCount = currentOfferData.travelersCount;
            var totalAge = 0;
            
            for (var i = 0; i < currentOfferData.ages.length; i++) {
                totalAge += parseInt(currentOfferData.ages[i]);
            }
            var avgAge = totalAge / currentOfferData.ages.length;
            
            var basePrice = amount * 0.002;
            basePrice *= travelersCount;
            
            if (avgAge > 65) basePrice *= 1.5;
            else if (avgAge > 45) basePrice *= 1.2;
            
            return Math.round(basePrice);
        }

        function getCompanyFeatures(companyName) {
            var features = {
                'Euroins': ['–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —Ä–∞–∑—Ö–æ–¥–∏ –¥–æ –ª–∏–º–∏—Ç–∞', '24/7 –∞—Å–∏—Å—Ç–µ–Ω—Ç—Å–∫–∞ –ª–∏–Ω–∏—è', '–ü–æ–∫—Ä–∏—Ç–∏–µ –∑–∞ –±–∞–≥–∞–∂ –¥–æ 1000‚Ç¨', '–û—Ç–º—è–Ω–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ', '–ó–∞–±–∞–≤—è–Ω–µ –Ω–∞ –ø–æ–ª–µ—Ç', '–°–ø–µ—à–Ω–∞ —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è'],
                'Allianz': ['–°–≤–µ—Ç–æ–≤–Ω–æ –ø–æ–∫—Ä–∏—Ç–∏–µ', '–°–ø–æ—Ä—Ç–Ω–∏ –¥–µ–π–Ω–æ—Å—Ç–∏', '–†–∞–∑—à–∏—Ä–µ–Ω–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ –ø–æ–∫—Ä–∏—Ç–∏–µ', '–ë—ä—Ä–∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —â–µ—Ç–∏', '–¢–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞', '–ü–æ–∫—Ä–∏—Ç–∏–µ –∑–∞ –±—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç'],
                'Uniqa': ['–ì—ä–≤–∫–∞–≤–∏ —É—Å–ª–æ–≤–∏—è', '–û–Ω–ª–∞–π–Ω —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', '–°–µ–º–µ–π–Ω–∏ –æ—Ç—Å—Ç—ä–ø–∫–∏', '–ü–æ–∫—Ä–∏—Ç–∏–µ –∑–∞ COVID-19', '–•—Ä–æ–Ω–∏—á–Ω–∏ –∑–∞–±–æ–ª—è–≤–∞–Ω–∏—è', '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞ –ø–æ–º–æ—â'],
                'Lev Ins': ['–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏ —Ü–µ–Ω–∏', '–ë—ä—Ä–∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞', '–ú–µ—Å—Ç–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏', '–û–ø—Ä–æ—Å—Ç–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞', '–û–Ω–ª–∞–π–Ω –ø–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ —â–µ—Ç–∏', '–ë–µ–∑ —Ñ—Ä–∞–Ω—à–∏–∑–∞'],
                'Bulstrad': ['–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–µ–Ω –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª', '–®–∏—Ä–æ–∫–∞ –º—Ä–µ–∂–∞ –ø–∞—Ä—Ç–Ω—å–æ—Ä–∏', '–ù–∞–¥–µ–∂–¥–Ω–æ –ø–æ–∫—Ä–∏—Ç–∏–µ', '–î—ä–ª–≥–æ–≥–æ–¥–∏—à–µ–Ω –æ–ø–∏—Ç', '–ü–æ–∫—Ä–∏—Ç–∏–µ –∑–∞ –≤—ä–∑—Ä–∞—Å—Ç–Ω–∏', '–°–ø–µ—Ü–∏–∞–ª–Ω–∏ —É—Å–ª–æ–≤–∏—è –∑–∞ –¥–µ—Ü–∞']
            };
            return features[companyName] || [];
        }

        function getCompanyDetails(companyName) {
            var details = {
                'Euroins': {
                    description: '–í–æ–¥–µ—â –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª –≤ –ë—ä–ª–≥–∞—Ä–∏—è',
                    rating: '8.5',
                    claimProcessing: '24-48 —á–∞—Å–∞',
                    phone: '+359 700 11 011',
                    covidCoverage: '–î–∞'
                },
                'Allianz': {
                    description: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–µ–Ω –ª–∏–¥–µ—Ä –≤ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–µ—Ç–æ',
                    rating: '9.2',
                    claimProcessing: '12-24 —á–∞—Å–∞',
                    phone: '+359 2 8166 166',
                    covidCoverage: '–î–∞'
                },
                'Uniqa': {
                    description: '–ê–≤—Å—Ç—Ä–∏–π—Å–∫–∞ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–Ω–∞ –≥—Ä—É–ø–∞',
                    rating: '8.8',
                    claimProcessing: '24-36 —á–∞—Å–∞',
                    phone: '+359 2 8165 555',
                    covidCoverage: '–î–∞'
                },
                'Lev Ins': {
                    description: '–ë—ä–ª–≥–∞—Ä—Å–∫–∏ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª —Å –¥–æ–±—Ä–∏ —Ü–µ–Ω–∏',
                    rating: '7.9',
                    claimProcessing: '48-72 —á–∞—Å–∞',
                    phone: '+359 2 9700 700',
                    covidCoverage: '–ß–∞—Å—Ç–∏—á–Ω–æ'
                },
                'Bulstrad': {
                    description: '–ù–∞–π-—Å—Ç–∞—Ä–∏—è—Ç –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª –≤ –ë—ä–ª–≥–∞—Ä–∏—è',
                    rating: '8.1',
                    claimProcessing: '36-48 —á–∞—Å–∞',
                    phone: '+359 2 8166 100',
                    covidCoverage: '–î–∞'
                }
            };
            return details[companyName] || {};
        }

        function showCompanyInfo(companyName) {
            var details = getCompanyDetails(companyName);
            var features = getCompanyFeatures(companyName);
            
            var message = details.description + '\n\n–†–µ–π—Ç–∏–Ω–≥: ' + details.rating + '/10\n';
            message += '–¢–µ–ª–µ—Ñ–æ–Ω: ' + details.phone + '\n';
            message += '–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —â–µ—Ç–∏: ' + details.claimProcessing + '\n\n';
            message += '–û—Å–Ω–æ–≤–Ω–∏ –ø–æ–∫—Ä–∏—Ç–∏—è:\n‚Ä¢ ' + features.join('\n‚Ä¢ ');
            
            showAlert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ ' + companyName, message);
        }

        function selectInsuranceOffer(companyName, price) {
            showConfirm('–ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ –∏–∑–±–æ—Ä–∞', 
                '–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑–±–µ—Ä–µ—Ç–µ –æ—Ñ–µ—Ä—Ç–∞—Ç–∞ –æ—Ç ' + companyName + ' –∑–∞ ' + price + ' –ª–≤.?',
                function() { createOfferWithCompany(companyName, price); },
                null
            );
        }

        function createOfferWithCompany(companyName, price) {
            var newOfferNumber = 'OF-2025-' + String(offers.length + 1).padStart(3, '0');
            var newOffer = {
                id: newOfferNumber,
                client: '–ù–æ–≤ –∫–ª–∏–µ–Ω—Ç',
                destination: currentOfferData.destination,
                dates: currentOfferData.departureDate + ' - ' + currentOfferData.returnDate,
                premium: price + ' –ª–≤.',
                company: companyName,
                travelersCount: currentOfferData.travelersCount,
                status: 'offer'
            };

            offers.push(newOffer);
            updateOffersTable();

            showAlert('–£—Å–ø–µ—à–Ω–æ', '–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –±–µ—à–µ —Å—ä–∑–¥–∞–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n–ù–æ–º–µ—Ä: ' + newOfferNumber + '\n–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª: ' + companyName + '\n–¶–µ–Ω–∞: ' + price + ' –ª–≤.');
            
            currentOfferData = {};
            showScreen('dashboardScreen');
            showDashboardTab('offers');
        }

        function updateOffersTable() {
            var tbody = document.getElementById('offersTableBody');
            tbody.innerHTML = '';

            for (var i = 0; i < offers.length; i++) {
                var offer = offers[i];
                var row = tbody.insertRow();
                row.innerHTML = '<td>' + offer.id + '</td>' +
                               '<td>' + offer.client + '</td>' +
                               '<td>' + offer.destination + '</td>' +
                               '<td>' + offer.dates + '</td>' +
                               '<td>' + offer.premium + '</td>' +
                               '<td><span class="badge badge-info">' + offer.company + '</span></td>' +
                               '<td><span class="badge badge-warning">–û—Ñ–µ—Ä—Ç–∞</span></td>' +
                               '<td>' +
                               '<button class="btn btn-secondary" onclick="editOffer(\'' + offer.id + '\')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>' +
                               '<button class="btn btn-primary" onclick="createPolicyFromOffer(\'' + offer.id + '\')">–ò–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∞</button>' +
                               '<button class="btn" onclick="viewOffer(\'' + offer.id + '\')">–ü—Ä–µ–≥–ª–µ–¥</button>' +
                               '</td>';
            }
        }

        function editOffer(offerId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞: ' + offerId);
        }

        function viewOffer(offerId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –æ—Ñ–µ—Ä—Ç–∞: ' + offerId);
        }

        // Policy creation from offers
        function createPolicyFromOffer(offerId) {
            var offer = null;
            for (var i = 0; i < offers.length; i++) {
                if (offers[i].id === offerId) {
                    offer = offers[i];
                    break;
                }
            }
            
            if (!offer) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞!');
                return;
            }

            // Populate offer details in modal
            document.getElementById('offerNumber').textContent = offerId;
            
            var detailsHtml = '';
            detailsHtml += '<div><strong>–ö–ª–∏–µ–Ω—Ç:</strong><br>' + offer.client + '</div>';
            detailsHtml += '<div><strong>–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è:</strong><br>' + offer.destination + '</div>';
            detailsHtml += '<div><strong>–î–∞—Ç–∏:</strong><br>' + offer.dates + '</div>';
            detailsHtml += '<div><strong>–ü—Ä–µ–º–∏—è:</strong><br>' + offer.premium + '</div>';
            detailsHtml += '<div><strong>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª:</strong><br>' + offer.company + '</div>';
            detailsHtml += '<div><strong>–ü—ä—Ç—É–≤–∞—â–∏:</strong><br>' + offer.travelersCount + ' –¥—É—à–∏</div>';
            
            document.getElementById('offerDetails').innerHTML = detailsHtml;
            
            // Pre-fill client name if it's not "–ù–æ–≤ –∫–ª–∏–µ–Ω—Ç"
            if (offer.client !== '–ù–æ–≤ –∫–ª–∏–µ–Ω—Ç') {
                document.getElementById('clientName').value = offer.client;
            } else {
                document.getElementById('clientName').value = '';
            }
            
            // Clear other fields
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientAddress').value = '';

            showModal('createPolicyModal');
        }

        function finalizePolicy() {
            var offerId = document.getElementById('offerNumber').textContent;
            var clientName = document.getElementById('clientName').value.trim();
            var clientPhone = document.getElementById('clientPhone').value.trim();
            var clientEmail = document.getElementById('clientEmail').value.trim();
            var clientAddress = document.getElementById('clientAddress').value.trim();
            
            if (!clientName || !clientPhone || !clientEmail || !clientAddress) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞ –∑–∞ –∫–ª–∏–µ–Ω—Ç–∞!');
                return;
            }
            
            var offer = null;
            var offerIndex = -1;
            
            for (var i = 0; i < offers.length; i++) {
                if (offers[i].id === offerId) {
                    offer = offers[i];
                    offerIndex = i;
                    break;
                }
            }
            
            if (offer) {
                var newPolicyNumber = 'TG-2025-' + String(policies.length + 1).padStart(3, '0');
                var newPolicy = {
                    id: newPolicyNumber,
                    client: clientName,
                    destination: offer.destination,
                    dates: offer.dates,
                    premium: offer.premium,
                    company: offer.company,
                    phone: clientPhone,
                    email: clientEmail,
                    address: clientAddress,
                    travelersCount: offer.travelersCount,
                    status: 'active'
                };

                policies.push(newPolicy);
                
                if (offerIndex > -1) {
                    offers.splice(offerIndex, 1);
                }

                updateOffersTable();
                updatePoliciesTable();

                hideModal('createPolicyModal');
                
                // Show success popup with preview button
                showCustomPopup('–£—Å–ø–µ—à–Ω–æ', '–ü–æ–ª–∏—Ü–∞—Ç–∞ –±–µ—à–µ –∏–∑–¥–∞–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n–ù–æ–º–µ—Ä –Ω–∞ –ø–æ–ª–∏—Ü–∞: ' + newPolicyNumber, 
                    function() { viewPolicy(newPolicyNumber); }, null);
                
                showDashboardTab('policies');
            }
        }

        // Preview functions
        function viewOffer(offerId) {
            var offer = null;
            for (var i = 0; i < offers.length; i++) {
                if (offers[i].id === offerId) {
                    offer = offers[i];
                    break;
                }
            }
            
            if (!offer) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞!');
                return;
            }

            var previewHtml = '';
            previewHtml += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">';
            previewHtml += '<h4 style="color: #4CAF50; margin-bottom: 15px;">–û—Ñ–µ—Ä—Ç–∞ ' + offer.id + '</h4>';
            previewHtml += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
            previewHtml += '<div><strong>–ö–ª–∏–µ–Ω—Ç:</strong><br>' + offer.client + '</div>';
            previewHtml += '<div><strong>–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è:</strong><br>' + offer.destination + '</div>';
            previewHtml += '<div><strong>–ü–µ—Ä–∏–æ–¥ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ:</strong><br>' + offer.dates + '</div>';
            previewHtml += '<div><strong>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª:</strong><br>' + offer.company + '</div>';
            previewHtml += '<div><strong>–ü—Ä–µ–º–∏—è:</strong><br><span style="font-size: 18px; color: #4CAF50; font-weight: bold;">' + offer.premium + '</span></div>';
            previewHtml += '<div><strong>–ë—Ä–æ–π –ø—ä—Ç—É–≤–∞—â–∏:</strong><br>' + offer.travelersCount + ' –¥—É—à–∏</div>';
            previewHtml += '</div>';
            previewHtml += '</div>';
            
            previewHtml += '<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">';
            previewHtml += '<strong>–°—Ç–∞—Ç—É—Å:</strong> –ê–∫—Ç–∏–≤–Ω–∞ –æ—Ñ–µ—Ä—Ç–∞<br>';
            previewHtml += '<small style="color: #666;">–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –µ –≤–∞–ª–∏–¥–Ω–∞ –∏ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –∏–∑–¥–∞–¥–µ–Ω–∞ –∫–∞—Ç–æ –ø–æ–ª–∏—Ü–∞</small>';
            previewHtml += '</div>';

            document.getElementById('offerPreviewContent').innerHTML = previewHtml;
            showModal('offerPreviewModal');
        }

        function viewPolicy(policyId) {
            var policy = null;
            for (var i = 0; i < policies.length; i++) {
                if (policies[i].id === policyId) {
                    policy = policies[i];
                    break;
                }
            }
            
            if (!policy) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ü–æ–ª–∏—Ü–∞—Ç–∞ –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω–∞!');
                return;
            }

            var previewHtml = '';
            previewHtml += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">';
            previewHtml += '<h4 style="color: #007bff; margin-bottom: 15px;">–ü–æ–ª–∏—Ü–∞ ' + policy.id + '</h4>';
            previewHtml += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
            previewHtml += '<div><strong>–ö–ª–∏–µ–Ω—Ç:</strong><br>' + policy.client + '</div>';
            previewHtml += '<div><strong>–î–µ—Å—Ç–∏–Ω–∞—Ü–∏—è:</strong><br>' + policy.destination + '</div>';
            previewHtml += '<div><strong>–ü–µ—Ä–∏–æ–¥ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ:</strong><br>' + policy.dates + '</div>';
            previewHtml += '<div><strong>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª:</strong><br>' + policy.company + '</div>';
            previewHtml += '<div><strong>–ü—Ä–µ–º–∏—è:</strong><br><span style="font-size: 18px; color: #007bff; font-weight: bold;">' + policy.premium + '</span></div>';
            previewHtml += '<div><strong>–ë—Ä–æ–π –ø—ä—Ç—É–≤–∞—â–∏:</strong><br>' + policy.travelersCount + ' –¥—É—à–∏</div>';
            previewHtml += '</div>';
            
            if (policy.phone) {
                previewHtml += '<hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">';
                previewHtml += '<h5 style="margin-bottom: 15px;">–î–∞–Ω–Ω–∏ –∑–∞ –∫–ª–∏–µ–Ω—Ç–∞</h5>';
                previewHtml += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
                previewHtml += '<div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong><br>' + policy.phone + '</div>';
                previewHtml += '<div><strong>–ò–º–µ–π–ª:</strong><br>' + policy.email + '</div>';
                previewHtml += '<div style="grid-column: 1 / -1;"><strong>–ê–¥—Ä–µ—Å:</strong><br>' + policy.address + '</div>';
                previewHtml += '</div>';
            }
            
            previewHtml += '</div>';
            
            previewHtml += '<div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">';
            previewHtml += '<strong>–°—Ç–∞—Ç—É—Å:</strong> –ê–∫—Ç–∏–≤–Ω–∞ –ø–æ–ª–∏—Ü–∞<br>';
            previewHtml += '<small style="color: #666;">–ü–æ–ª–∏—Ü–∞—Ç–∞ –µ –∏–∑–¥–∞–¥–µ–Ω–∞ –∏ –≤–∞–ª–∏–¥–Ω–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ</small>';
            previewHtml += '</div>';

            document.getElementById('policyPreviewContent').innerHTML = previewHtml;
            showModal('policyPreviewModal');
        }

        function updatePoliciesTable() {
            var tbody = document.getElementById('policiesTableBody');
            tbody.innerHTML = '';

            for (var i = 0; i < policies.length; i++) {
                var policy = policies[i];
                var row = tbody.insertRow();
                row.innerHTML = '<td>' + policy.id + '</td>' +
                               '<td>' + policy.client + '</td>' +
                               '<td>' + policy.destination + '</td>' +
                               '<td>' + policy.dates + '</td>' +
                               '<td>' + policy.premium + '</td>' +
                               '<td><span class="badge badge-info">' + policy.company + '</span></td>' +
                               '<td><span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–∞</span></td>' +
                               '<td>' +
                               '<button class="btn btn-secondary" onclick="editPolicy(\'' + policy.id + '\')">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>' +
                               '<button class="btn btn-primary" onclick="viewPolicy(\'' + policy.id + '\')">–ü—Ä–µ–≥–ª–µ–¥</button>' +
                               '</td>';
            }
        }

        // Export functionality
        function performExport() {
            var exportType = document.getElementById('exportType').value;
            var fromDate = document.getElementById('exportFromDate').value;
            var toDate = document.getElementById('exportToDate').value;
            var format = document.getElementById('exportFormat').value;

            if (!fromDate || !toDate) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ –ø–µ—Ä–∏–æ–¥ –∑–∞ –µ–∫—Å–ø–æ—Ä—Ç!');
                return;
            }

            var message = '–ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ ' + exportType + ' –æ—Ç ' + fromDate + ' –¥–æ ' + toDate + ' –≤—ä–≤ —Ñ–æ—Ä–º–∞—Ç ' + format + '...';
            showAlert('–ï–∫—Å–ø–æ—Ä—Ç', message);
        }

        function editPolicy(policyId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏—Ü–∞: ' + policyId);
        }

        function viewPolicy(policyId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ø–æ–ª–∏—Ü–∞: ' + policyId);
        }

        // Global variables for sorting
        var currentOfferSort = { column: null, direction: null };
        var currentPolicySort = { column: null, direction: null };

        // New sorting functions for offers
        function sortOffersBy(column) {
            // Toggle sort direction
            if (currentOfferSort.column === column) {
                currentOfferSort.direction = currentOfferSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentOfferSort.column = column;
                currentOfferSort.direction = 'asc';
            }

            // Update header styles
            var headers = document.querySelectorAll('#offersTab .sortable');
            for (var i = 0; i < headers.length; i++) {
                headers[i].classList.remove('sort-asc', 'sort-desc');
            }
            
            var currentHeader = document.getElementById(column + 'Header');
            currentHeader.classList.add('sort-' + currentOfferSort.direction);

            // Sort the table
            var tbody = document.getElementById('offersTableBody');
            var rows = [];
            var tbodyRows = tbody.getElementsByTagName('tr');
            
            for (var i = 0; i < tbodyRows.length; i++) {
                rows.push(tbodyRows[i]);
            }

            rows.sort(function(a, b) {
                var aVal, bVal;
                switch(column) {
                    case 'client':
                        aVal = a.cells[1].textContent.trim();
                        bVal = b.cells[1].textContent.trim();
                        break;
                    case 'destination':
                        aVal = a.cells[2].textContent.trim();
                        bVal = b.cells[2].textContent.trim();
                        break;
                    case 'dates':
                        aVal = a.cells[3].textContent.trim();
                        bVal = b.cells[3].textContent.trim();
                        break;
                    case 'premium':
                        aVal = parseFloat(a.cells[4].textContent.replace(/[^\d.]/g, ''));
                        bVal = parseFloat(b.cells[4].textContent.replace(/[^\d.]/g, ''));
                        break;
                    case 'company':
                        aVal = a.cells[5].textContent.trim();
                        bVal = b.cells[5].textContent.trim();
                        break;
                    default:
                        return 0;
                }
                
                var result;
                if (typeof aVal === 'number') {
                    result = aVal - bVal;
                } else {
                    result = aVal.localeCompare(bVal);
                }
                
                return currentOfferSort.direction === 'desc' ? -result : result;
            });

            tbody.innerHTML = '';
            for (var i = 0; i < rows.length; i++) {
                tbody.appendChild(rows[i]);
            }
        }

        // New sorting functions for policies
        function sortPoliciesBy(column) {
            // Toggle sort direction
            if (currentPolicySort.column === column) {
                currentPolicySort.direction = currentPolicySort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentPolicySort.column = column;
                currentPolicySort.direction = 'asc';
            }

            // Update header styles
            var headers = document.querySelectorAll('#policiesTab .sortable');
            for (var i = 0; i < headers.length; i++) {
                headers[i].classList.remove('sort-asc', 'sort-desc');
            }
            
            var currentHeader = document.getElementById('policy' + column.charAt(0).toUpperCase() + column.slice(1) + 'Header');
            currentHeader.classList.add('sort-' + currentPolicySort.direction);

            // Sort the table
            var tbody = document.getElementById('policiesTableBody');
            var rows = [];
            var tbodyRows = tbody.getElementsByTagName('tr');
            
            for (var i = 0; i < tbodyRows.length; i++) {
                rows.push(tbodyRows[i]);
            }

            rows.sort(function(a, b) {
                var aVal, bVal;
                switch(column) {
                    case 'client':
                        aVal = a.cells[1].textContent.trim();
                        bVal = b.cells[1].textContent.trim();
                        break;
                    case 'destination':
                        aVal = a.cells[2].textContent.trim();
                        bVal = b.cells[2].textContent.trim();
                        break;
                    case 'dates':
                        aVal = a.cells[3].textContent.trim();
                        bVal = b.cells[3].textContent.trim();
                        break;
                    case 'premium':
                        aVal = parseFloat(a.cells[4].textContent.replace(/[^\d.]/g, ''));
                        bVal = parseFloat(b.cells[4].textContent.replace(/[^\d.]/g, ''));
                        break;
                    case 'company':
                        aVal = a.cells[5].textContent.trim();
                        bVal = b.cells[5].textContent.trim();
                        break;
                    default:
                        return 0;
                }
                
                var result;
                if (typeof aVal === 'number') {
                    result = aVal - bVal;
                } else {
                    result = aVal.localeCompare(bVal);
                }
                
                return currentPolicySort.direction === 'desc' ? -result : result;
            });

            tbody.innerHTML = '';
            for (var i = 0; i < rows.length; i++) {
                tbody.appendChild(rows[i]);
            }
        }

        // Updated search functions
        function searchOffers() {
            var searchTerm = document.getElementById('searchOffers').value.toLowerCase();
            var tbody = document.getElementById('offersTableBody');
            var rows = tbody.getElementsByTagName('tr');

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var text = row.textContent.toLowerCase();
                row.style.display = text.indexOf(searchTerm) !== -1 ? '' : 'none';
            }
        }

        function searchPolicies() {
            var searchTerm = document.getElementById('searchPolicies').value.toLowerCase();
            var tbody = document.getElementById('policiesTableBody');
            var rows = tbody.getElementsByTagName('tr');

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var text = row.textContent.toLowerCase();
                row.style.display = text.indexOf(searchTerm) !== -1 ? '' : 'none';
            }
        }

        // Remove the old clearOfferSorting and clearPolicySorting functions since we removed the buttons
        function clearOfferSearch() {
            document.getElementById('searchOffers').value = '';
            searchOffers(); // Re-run search to show all items
        }

        function clearPolicySearch() {
            document.getElementById('searchPolicies').value = '';
            searchPolicies(); // Re-run search to show all items
        }

        // Keep the old function for backwards compatibility
        function clearOfferFilters() {
            clearOfferSearch();
        }

        function clearPolicyFilters() {
            clearPolicySearch();
        }

        function clearFilters() {
            document.getElementById('searchOffers').value = '';
            document.getElementById('sortOffers').value = '';
            document.getElementById('filterCompany').value = '';
        }

        function searchPolicies() {
            var searchTerm = document.getElementById('searchPolicies').value.toLowerCase();
            var companyFilter = document.getElementById('filterPolicyCompany').value;
            var tbody = document.getElementById('policiesTableBody');
            var rows = tbody.getElementsByTagName('tr');

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var text = row.textContent.toLowerCase();
                var companyCell = row.cells[5].textContent;
                
                var matchesSearch = text.indexOf(searchTerm) !== -1;
                var matchesCompany = !companyFilter || companyCell.indexOf(companyFilter) !== -1;
                
                row.style.display = (matchesSearch && matchesCompany) ? '' : 'none';
            }
        }

        function sortPolicies() {
            var sortBy = document.getElementById('sortPolicies').value;
            if (!sortBy) return;

            var tbody = document.getElementById('policiesTableBody');
            var rows = [];
            var tbodyRows = tbody.getElementsByTagName('tr');
            
            for (var i = 0; i < tbodyRows.length; i++) {
                rows.push(tbodyRows[i]);
            }

            rows.sort(function(a, b) {
                var aVal, bVal;
                switch(sortBy) {
                    case 'client':
                        aVal = a.cells[1].textContent;
                        bVal = b.cells[1].textContent;
                        break;
                    case 'destination':
                        aVal = a.cells[2].textContent;
                        bVal = b.cells[2].textContent;
                        break;
                    case 'premium':
                        aVal = parseFloat(a.cells[4].textContent.replace(/[^\d.]/g, ''));
                        bVal = parseFloat(b.cells[4].textContent.replace(/[^\d.]/g, ''));
                        break;
                    case 'company':
                        aVal = a.cells[5].textContent;
                        bVal = b.cells[5].textContent;
                        break;
                    default:
                        return 0;
                }
                
                if (typeof aVal === 'number') {
                    return bVal - aVal;
                }
                return aVal.localeCompare(bVal);
            });

            tbody.innerHTML = '';
            for (var i = 0; i < rows.length; i++) {
                tbody.appendChild(rows[i]);
            }
        }

        function filterPolicies() {
            searchPolicies();
        }

        // User management functions
        function addNewUser() {
            var name = document.getElementById('newUserName').value;
            var email = document.getElementById('newUserEmail').value;
            
            if (!name || !email) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!');
                return;
            }

            showAlert('–£—Å–ø–µ—à–Ω–æ', '–ü–æ–∫–∞–Ω–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞ ' + email);
            hideModal('addUserModal');
            
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserEmail').value = '';
        }

        function clearPolicyFilters() {
            document.getElementById('searchPolicies').value = '';
            document.getElementById('sortPolicies').value = '';
            document.getElementById('filterPolicyCompany').value = '';
        }

        function addNewUser() {
            var name = document.getElementById('newUserName').value;
            var email = document.getElementById('newUserEmail').value;
            
            if (!name || !email) {
                showAlert('–ì—Ä–µ—à–∫–∞', '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!');
                return;
            }

            showAlert('–£—Å–ø–µ—à–Ω–æ', '–ü–æ–∫–∞–Ω–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞ ' + email);
            hideModal('addUserModal');
            
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserEmail').value = '';
        }

        function editUser(userId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª: ' + userId);
        }

        function removeUser(userId) {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª: ' + userId);
        }

        function finalizePolicy() {
            showAlert('–§—É–Ω–∫—Ü–∏—è', '–°—ä–∑–¥–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ –ø–æ–ª–∏—Ü–∏ —â–µ –±—ä–¥–µ –¥–æ–±–∞–≤–µ–Ω–æ —Å–∫–æ—Ä–æ...');
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', function() {
            if (currentUserRole === 'admin') {
                document.getElementById('usersNavLink').style.display = 'block';
            }
            updateTravelerButtons();
        });

        // Event listeners
        document.addEventListener('click', function(event) {
            var dropdown = document.getElementById('countryDropdown');
            var input = document.getElementById('travelDestination');
            if (dropdown && input && !dropdown.contains(event.target) && event.target !== input) {
                dropdown.style.display = 'none';
            }
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
            if (event.target.classList.contains('custom-popup')) {
                hideCustomPopup();
            }
        };
        // === Broker / Master-admin functionality ===

// 1) Master credentials (choose your own secure password!)
var masterUser = { email: 'master@travelxyz.com', password: 'YOUR_MASTER_PASSWORD' };

// 2) In-memory list of agencies (initialize from your real data if you have it)
var agencies = [
  { name: '–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞ –∞–≥–µ–Ω—Ü–∏—è XYZ', email:'xyz@travelxyz.com', password:'xyzpass' }
];

// 3) Entry point for broker login
function brokerLogin() {
  var email = prompt('Email:'), pass = prompt('Password:');
  if (email === masterUser.email && pass === masterUser.password) {
    // master-admin mode
    currentUserRole = 'master';
    showBrokerScreen();
  } else {
    // try agency login
    var agency = agencies.find(a => a.email === email && a.password === pass);
    if (agency) {
      currentUserRole = 'agency';
      currentAgency = agency;
      showScreen('dashboardScreen');
      updateDashboardForAgency();
    } else {
      showAlert('–ì—Ä–µ—à–∫–∞', '–ù–µ–≤–∞–ª–∏–¥–Ω–∏ –¥–∞–Ω–Ω–∏!');
    }
  }
}

// 4) Show the broker-admin screen and render the list
function showBrokerScreen() {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('brokerScreen').classList.add('active');
  renderAgencies();
}

// 5) Populate the UL with agencies
function renderAgencies() {
  var ul = document.getElementById('agenciesList');
  ul.innerHTML = '';
  agencies.forEach((a,i) => {
    var li = document.createElement('li');
    li.innerHTML = `
      ${a.name}
      <button class="btn btn-primary" onclick="loginAgency(${i})">Login</button>
      <button class="btn btn-danger" onclick="removeAgency(${i})">Remove</button>
    `;
    ul.appendChild(li);
  });
}

// 6) Add / remove agencies
function addAgency() {
  var name = document.getElementById('newAgencyName').value.trim();
  if (!name) return showAlert('–ì—Ä–µ—à–∫–∞','–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ!');
  var email = prompt('Email for this agency:');
  var pass = prompt('Password for this agency:');
  agencies.push({ name, email, password: pass });
  renderAgencies();
}
function removeAgency(idx) {
  if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ?')) {
    agencies.splice(idx,1);
    renderAgencies();
  }
}

// 7) Login _into_ a specific agency
function loginAgency(idx) {
  currentUserRole = 'agency';
  currentAgency = agencies[idx];
  showScreen('dashboardScreen');
  updateDashboardForAgency();
}

// 8) After agency login, adjust the dashboard header
function updateDashboardForAgency() {
  // change welcome text
  document.querySelector('#dashboardScreen .user-info span')
    .textContent = '–î–æ–±—Ä–µ –¥–æ—à–ª–∏, ' + currentAgency.name;
  // ensure all normal tabs are visible
  document.getElementById('usersNavLink').style.display = 'none';
  // (optional) lock down features based on role
}

// === end broker / master-admin additions ===
    </script>
</body>
</html>


